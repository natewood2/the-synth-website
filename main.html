<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Synthesizer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300&display=swap');

        body { 
            margin: 0; 
            font-family: 'Prompt', sans-serif; 
            background-color: black;
            color: white;
        }
        canvas { 
            display: block; 
        }
        #header {
            text-align: center;
            font-size: 2em;
            font-weight: 300;
            font-style: italic;
            margin: 20px 0;
            color: white;
        }
        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }
        #playButton {
            font-family: 'Prompt', sans-serif;
            font-size: 1em;
            padding: 10px 20px;
            background-color: #0f55e3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="header">the synth website</div>
    <div id="controls">
        <button id="playButton">Play Sequence</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FontLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/geometries/TextGeometry.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.35/Tone.min.js"></script>
    <script>
        // Set up scene, camera, and renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Orbit controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);

        // Load texture
        const textureLoader = new THREE.TextureLoader();
        const synthTexture = textureLoader.load('textures/Plastic005_1K-JPG_Color.jpg'); // Replace with your texture file path

        // Synthesizer body
        const bodyGeometry = new THREE.BoxGeometry(4, 0.5, 2);
        const bodyMaterial = new THREE.MeshStandardMaterial({ map: synthTexture });
        const synthBody = new THREE.Mesh(bodyGeometry, bodyMaterial);
        synthBody.position.y = 0.25;
        scene.add(synthBody);

        // Adding some lights to the scene
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(5, 5, 5).normalize();
        scene.add(directionalLight);

        // Load font and add text
        const fontLoader = new THREE.FontLoader();
        fontLoader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', function (font) {
            const textGeometry = new THREE.TextGeometry('Synth', {
                font: font,
                size: 0.2,
                height: 0.02,
                curveSegments: 12,
                bevelEnabled: false
            });
            const textMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
            const textMesh = new THREE.Mesh(textGeometry, textMaterial);
            textMesh.position.set(-1.5, 0.55, 0);
            scene.add(textMesh);
        });

        // Knobs
        function createKnob(x, z) {
            const knobGroup = new THREE.Group();

            const knobGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.2, 32);
            const knobMaterial = new THREE.MeshBasicMaterial({ color: 0x444444 });
            const knob = new THREE.Mesh(knobGeometry, knobMaterial);
            knob.position.y = 0.1;
            knobGroup.add(knob);

            // Add ridges around the knob
            const ridgeGeometry = new THREE.BoxGeometry(0.02, 0.2, 0.03); // Longer and slimmer dimensions
            const ridgeMaterial = new THREE.MeshBasicMaterial({ color: 0x474747 });
            const ridgeCount = 16;
            for (let i = 0; i < ridgeCount; i++) {
                const angle = (i / ridgeCount) * Math.PI * 2;
                const ridge = new THREE.Mesh(ridgeGeometry, ridgeMaterial);
                ridge.position.set(
                    0.11 * Math.cos(angle),
                    0.1,
                    0.11 * Math.sin(angle)
                );
                ridge.rotation.y = -angle;
                knobGroup.add(ridge);
            }

            knobGroup.position.set(x, 0.5, z);
            scene.add(knobGroup);
        }

        // Adding knobs
        createKnob(-1, 0.5);
        createKnob(0, 0.5);
        createKnob(1, 0.5);

        // Buttons
        const buttons = [];
        function createButton(x, z, note) {
            const buttonGeometry = new THREE.BoxGeometry(0.2, 0.1, 0.2); // Size of buttons
            const buttonMaterial = new THREE.MeshBasicMaterial({ color: 0x0f55e3 });
            const button = new THREE.Mesh(buttonGeometry, buttonMaterial);
            button.position.set(x, 0.5, z); // Position of buttons
            button.userData = { note }; // Store the note in userData
            scene.add(button);
            buttons.push(button);
        }

        // Adding buttons with different notes closer together
        createButton(-1, -0.5, "C4");
        createButton(-0.6, -0.5, "D4");
        createButton(-0.2, -0.5, "E4");
        createButton(0.2, -0.5, "F4");
        createButton(0.6, -0.5, "G4");
        createButton(1, -0.5, "A4");
        createButton(1.4, -0.5, "B4");
        createButton(1.8, -0.5, "C5");

        // Setting up the camera
        camera.position.z = 5;

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Tone.js setup
        const synth = new Tone.Synth().toDestination();

        // Sequence storage
        let noteSequence = [];

        // Add click event for buttons to change color and store note
        function onMouseClick(event) {
            const mouse = new THREE.Vector2();
            const raycaster = new THREE.Raycaster();

            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(buttons);
            if (intersects.length > 0) {
                const button = intersects[0].object;
                button.material.color.set(0x0055e3); // Change to a different shade of blue
                noteSequence.push(button.userData.note); // Store the note in the sequence
            }
        }

        window.addEventListener('click', onMouseClick);

        // Function to play the sequence
        function playSequence() {
            if (noteSequence.length === 0) return;

            const now = Tone.now();
            noteSequence.forEach((note, index) => {
                synth.triggerAttackRelease(note, "8n", now + index * 0.1);
            });
        }

        // Function to reset the sequence
        function resetSequence() {
            noteSequence = [];
            buttons.forEach(button => {
                button.material.color.set(0x0f55e3); // Reset button color
            });
        }

        // Add event listeners for the play button
        document.getElementById('playButton').addEventListener('click', playSequence);
        document.getElementById('playButton').addEventListener('dblclick', resetSequence);
    </script>
</body>
</html>